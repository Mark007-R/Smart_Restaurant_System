{% extends "base.html" %}
{% block content %}

<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        --danger-gradient: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    * {
        transition-property: color, background-color, border-color, box-shadow;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 300ms;
    }

    .page-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
        animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Header Section */
    .results-header {
        text-align: center;
        padding: 3rem 2rem;
        background: var(--primary-gradient);
        border-radius: 1.5rem;
        margin-bottom: 3rem;
        box-shadow: var(--shadow-lg);
        color: white;
        position: relative;
        overflow: hidden;
    }

    .results-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
    }

    @keyframes rotate {
        from {
            transform: rotate(0deg);
        }

        to {
            transform: rotate(360deg);
        }
    }

    .results-header h2 {
        font-size: 2.5rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
        position: relative;
        z-index: 1;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .results-header p {
        font-size: 1.1rem;
        opacity: 0.95;
        position: relative;
        z-index: 1;
    }

    .header-meta {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 1.5rem;
        flex-wrap: wrap;
        position: relative;
        z-index: 1;
        border-top: 1px solid rgba(255, 255, 255, 0.2);
        padding-top: 1.5rem;
        font-size: 0.95rem;
    }

    .header-meta span {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Statistics Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 2rem;
        margin: 3rem 0;
    }

    .stat-card {
        background: white;
        padding: 2rem;
        border-radius: 1.5rem;
        text-align: center;
        box-shadow: var(--shadow-md);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        border: 2px solid transparent;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: var(--primary-gradient);
        transition: height 0.3s ease;
    }

    .stat-card::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at top right, rgba(102, 126, 234, 0.05) 0%, transparent 100%);
        pointer-events: none;
    }

    .stat-card:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: var(--shadow-lg);
        border-color: rgba(102, 126, 234, 0.3);
    }

    .stat-card:hover::before {
        height: 100%;
        opacity: 0.08;
    }

    .stat-card.total::before {
        background: var(--primary-gradient);
    }

    .stat-card.positive::before {
        background: var(--success-gradient);
    }

    .stat-card.negative::before {
        background: var(--danger-gradient);
    }

    .stat-card.neutral::before {
        background: var(--info-gradient);
    }

    .stat-icon {
        width: 70px;
        height: 70px;
        margin: 0 auto 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-size: 2rem;
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
        transition: all 0.3s ease;
        position: relative;
        z-index: 1;
    }

    .stat-card:hover .stat-icon {
        transform: scale(1.15) rotate(10deg);
    }

    .stat-card.total .stat-icon {
        background: rgba(102, 126, 234, 0.15);
        color: #667eea;
    }

    .stat-card.positive .stat-icon {
        background: rgba(17, 153, 142, 0.15);
        color: #11998e;
    }

    .stat-card.negative .stat-icon {
        background: rgba(235, 51, 73, 0.15);
        color: #eb3349;
    }

    .stat-card.neutral .stat-icon {
        background: rgba(79, 172, 254, 0.15);
        color: #4facfe;
    }

    .stat-card h3 {
        font-size: 3rem;
        font-weight: 800;
        margin: 0.5rem 0;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        position: relative;
        z-index: 1;
    }

    .stat-card.positive h3 {
        background: var(--success-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-card.negative h3 {
        background: var(--danger-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-card.neutral h3 {
        background: var(--info-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .stat-card p {
        margin: 0;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-size: 0.85rem;
        font-weight: 600;
        position: relative;
        z-index: 1;
    }

    .stat-detail {
        font-size: 0.9rem;
        color: #94a3b8;
        margin-top: 0.75rem;
        font-weight: 500;
        position: relative;
        z-index: 1;
    }

    /* Source Breakdown */
    .source-breakdown {
        background: white;
        padding: 2.5rem;
        border-radius: 1.5rem;
        margin: 3rem 0;
        box-shadow: var(--shadow-md);
        border: 2px solid #f1f5f9;
    }

    .source-breakdown h4 {
        color: #1e293b;
        margin-bottom: 2rem;
        font-weight: 700;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .source-breakdown h4 i {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        background: var(--primary-gradient);
        color: white;
        font-size: 1rem;
    }

    .source-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .source-item {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: 1rem;
        transition: all 0.3s ease;
        border-left: 4px solid #667eea;
        position: relative;
    }

    .source-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at top right, rgba(102, 126, 234, 0.08) 0%, transparent 100%);
        border-radius: 1rem;
        pointer-events: none;
    }

    .source-item:hover {
        transform: translateY(-5px);
        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
        box-shadow: var(--shadow-md);
    }

    .source-name {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-weight: 600;
        color: #1e293b;
        position: relative;
        z-index: 1;
    }

    .source-name i {
        color: #667eea;
        font-size: 1.25rem;
    }

    .source-count {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: white;
        border-radius: 0.75rem;
        font-weight: 700;
        color: #667eea;
        font-size: 0.95rem;
        width: fit-content;
        border: 1px solid rgba(102, 126, 234, 0.2);
        position: relative;
        z-index: 1;
    }

    /* Category Tags */
    .category-section {
        background: white;
        padding: 2.5rem;
        border-radius: 1.5rem;
        margin: 3rem 0;
        box-shadow: var(--shadow-md);
        border: 2px solid #f1f5f9;
    }

    .category-section h4 {
        color: #1e293b;
        margin-bottom: 2rem;
        font-weight: 700;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .category-section h4 i {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        background: var(--primary-gradient);
        color: white;
        font-size: 1rem;
    }

    .category-tags-container {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .category-tag {
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1.25rem;
        border-radius: 2rem;
        font-size: 0.95rem;
        font-weight: 600;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        color: #1e293b;
        border: 2px solid #e2e8f0;
        transition: all 0.3s ease;
        box-shadow: var(--shadow-sm);
        cursor: pointer;
    }

    .category-tag i {
        color: #667eea;
    }

    .category-tag .badge {
        background: var(--primary-gradient) !important;
        color: white !important;
        font-size: 0.8rem;
        padding: 0.25rem 0.6rem !important;
    }

    .category-tag:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-md);
        border-color: #667eea;
        background: linear-gradient(135deg, var(--primary-gradient), var(--primary-gradient));
        background-clip: padding-box;
        color: white;
    }

    /* Visualization Section */
    .visualization-section {
        margin: 4rem 0;
    }

    .section-header {
        text-align: center;
        margin-bottom: 3rem;
        animation: slideUp 0.6s ease;
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .section-header h3 {
        color: #1e293b;
        font-weight: 800;
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }

    .section-header p {
        color: #64748b;
        font-size: 1.1rem;
    }

    .visualizations-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
    }

    .viz-card {
        background: white;
        border-radius: 1.5rem;
        padding: 2rem;
        box-shadow: var(--shadow-md);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        border: 2px solid #f1f5f9;
        overflow: hidden;
        position: relative;
    }

    .viz-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at top right, rgba(102, 126, 234, 0.05) 0%, transparent 100%);
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .viz-card:hover {
        box-shadow: var(--shadow-lg);
        border-color: rgba(102, 126, 234, 0.2);
        transform: translateY(-8px);
    }

    .viz-card:hover::before {
        opacity: 1;
    }

    .viz-card h4 {
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1.25rem;
        position: relative;
        z-index: 1;
    }

    .viz-card h4 i {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 10px;
        background: var(--primary-gradient);
        color: white;
        font-size: 1rem;
    }

    .viz-card img {
        width: 100%;
        height: auto;
        border-radius: 1rem;
        box-shadow: var(--shadow-sm);
        transition: transform 0.3s ease;
        position: relative;
        z-index: 1;
        background: #f8fafc;
    }

    .viz-card:hover img {
        transform: scale(1.02);
    }

    .viz-card.full-width {
        grid-column: 1 / -1;
    }

    .viz-placeholder {
        height: 300px;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: 1rem;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #94a3b8;
        font-weight: 600;
    }

    /* Reviews Section */
    .reviews-section {
        margin: 4rem 0;
    }

    .reviews-container {
        display: grid;
        gap: 1.5rem;
    }

    .review-item {
        background: white;
        padding: 2rem;
        border-radius: 1.5rem;
        box-shadow: var(--shadow-sm);
        border-left: 5px solid #667eea;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .review-item::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at top right, rgba(102, 126, 234, 0.08) 0%, transparent 100%);
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .review-item:hover {
        box-shadow: var(--shadow-md);
        transform: translateX(8px);
    }

    .review-item:hover::before {
        opacity: 1;
    }

    .review-item.positive {
        border-left-color: #10b981;
        background: linear-gradient(to right, rgba(16, 185, 129, 0.03) 0%, white 100%);
    }

    .review-item.negative {
        border-left-color: #ef4444;
        background: linear-gradient(to right, rgba(239, 68, 68, 0.03) 0%, white 100%);
    }

    .review-item.neutral {
        border-left-color: #3b82f6;
        background: linear-gradient(to right, rgba(59, 130, 246, 0.03) 0%, white 100%);
    }

    .review-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
        gap: 1rem;
        position: relative;
        z-index: 1;
    }

    .review-badges {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }

    .badge-sentiment {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.5rem 1rem;
        border-radius: 0.75rem;
        font-size: 0.9rem;
        font-weight: 600;
        background: white;
        border: 2px solid;
    }

    .badge-sentiment.positive {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border-color: #10b981;
    }

    .badge-sentiment.negative {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border-color: #ef4444;
    }

    .badge-sentiment.neutral {
        background: rgba(59, 130, 246, 0.1);
        color: #3b82f6;
        border-color: #3b82f6;
    }

    .badge-rating {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.5rem 1rem;
        border-radius: 0.75rem;
        font-size: 0.9rem;
        font-weight: 600;
        background: rgba(245, 158, 11, 0.1);
        color: #f59e0b;
        border: 2px solid #f59e0b;
    }

    .review-source {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #64748b;
        font-size: 0.9rem;
        position: relative;
        z-index: 1;
    }

    .review-text {
        color: #334155;
        line-height: 1.8;
        margin-bottom: 1.25rem;
        font-size: 1rem;
        position: relative;
        z-index: 1;
    }

    .review-keywords {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-top: 1.25rem;
        padding-top: 1.25rem;
        border-top: 1px solid #e2e8f0;
        position: relative;
        z-index: 1;
    }

    .keywords-label {
        display: flex;
        align-items: center;
        gap: 0.4rem;
        color: #64748b;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .keyword-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.4rem 0.9rem;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-radius: 1rem;
        font-size: 0.85rem;
        color: #475569;
        border: 1px solid #e2e8f0;
        transition: all 0.2s ease;
        font-weight: 500;
    }

    .keyword-badge:hover {
        background: var(--primary-gradient);
        color: white;
        border-color: transparent;
        transform: translateY(-2px);
    }

    /* Load More Button */
    .load-more-section {
        text-align: center;
        margin: 2rem 0;
    }

    .load-more-btn {
        padding: 1rem 2.5rem;
        background: var(--primary-gradient);
        color: white;
        border: none;
        border-radius: 1rem;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        box-shadow: var(--shadow-md);
        transition: all 0.3s ease;
    }

    .load-more-btn:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    /* Action Section */
    .action-section {
        margin-top: 4rem;
        padding: 3rem 2rem;
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
        border-radius: 1.5rem;
        text-align: center;
        border: 2px solid rgba(102, 126, 234, 0.1);
        position: relative;
        overflow: hidden;
    }

    .action-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at top right, rgba(102, 126, 234, 0.05) 0%, transparent 100%);
        pointer-events: none;
    }

    .action-section h4 {
        font-weight: 800;
        margin-bottom: 0.75rem;
        color: #1e293b;
        font-size: 1.8rem;
        position: relative;
        z-index: 1;
    }

    .action-section p {
        color: #64748b;
        font-size: 1.1rem;
        margin-bottom: 0;
        position: relative;
        z-index: 1;
    }

    .action-buttons {
        display: flex;
        gap: 1.5rem;
        justify-content: center;
        margin-top: 2rem;
        flex-wrap: wrap;
        position: relative;
        z-index: 1;
    }

    .action-btn {
        padding: 1rem 2.5rem;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 1rem;
        box-shadow: var(--shadow-md);
        transition: all 0.3s ease;
        border: none;
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        text-decoration: none;
        color: white;
    }

    .action-btn:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-lg);
    }

    .action-btn.btn-recommendations {
        background: var(--success-gradient);
    }

    .action-btn.btn-chat {
        background: var(--primary-gradient);
    }

    .action-btn.btn-back {
        background: #94a3b8;
    }

    .action-btn:hover {
        text-decoration: none;
    }

    /* Export Section */
    .export-section {
        text-align: center;
        margin-top: 2rem;
        padding: 1.5rem;
        background: white;
        border-radius: 1rem;
        box-shadow: var(--shadow-sm);
        position: relative;
        z-index: 1;
    }

    .export-section p {
        margin: 0;
        color: #64748b;
    }

    .export-section a {
        color: #667eea;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        margin-left: 0.5rem;
    }

    .export-section a:hover {
        color: #764ba2;
        text-decoration: underline;
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .visualizations-grid {
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        }
    }

    @media (max-width: 768px) {
        .page-container {
            padding: 1rem;
        }

        .results-header {
            padding: 2rem 1rem;
        }

        .results-header h2 {
            font-size: 1.75rem;
        }

        .header-meta {
            gap: 1rem;
            flex-direction: column;
            border-top: none;
            padding-top: 1rem;
        }

        .stats-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .stat-card h3 {
            font-size: 2.5rem;
        }

        .source-grid {
            grid-template-columns: 1fr;
        }

        .visualizations-grid {
            grid-template-columns: 1fr;
        }

        .viz-card {
            padding: 1.5rem;
        }

        .review-item {
            padding: 1.5rem;
        }

        .review-header {
            flex-direction: column;
            align-items: flex-start;
        }

        .action-buttons {
            flex-direction: column;
        }

        .action-btn {
            width: 100%;
            justify-content: center;
        }

        .category-tags-container {
            gap: 0.75rem;
        }
    }

    /* Print Styles */
    @media print {

        .action-section,
        .export-section,
        .load-more-section {
            display: none;
        }

        .review-item,
        .viz-card,
        .stat-card {
            page-break-inside: avoid;
        }
    }
</style>

<div class="page-container">
    <!-- Results Header -->
    <div class="results-header">
        <h2>
            <i class="fas fa-chart-line"></i>
            Analysis Results: {{ restaurant }}
        </h2>
        <p>AI-Powered comprehensive review analysis and insights</p>

        <div class="header-meta">
            <span>
                <i class="fas fa-comments"></i>
                {{ total_reviews }} Reviews Analyzed
            </span>
            <span>
                <i class="fas fa-calendar-alt"></i>
                Generated on {{ now_date }}
            </span>
            <span>
                <i class="fas fa-user"></i>
                User: {{ current_user }}
            </span>
        </div>
    </div>

    <!-- Statistics Grid -->
    <div class="stats-grid">
        <div class="stat-card total">
            <div class="stat-icon">
                <i class="fas fa-comments"></i>
            </div>
            <h3>{{ total_reviews }}</h3>
            <p>Total Reviews</p>
            <div class="stat-detail">Across all sources</div>
        </div>

        <div class="stat-card positive">
            <div class="stat-icon">
                <i class="fas fa-smile"></i>
            </div>
            <h3>{{ sentiment_percentages.Positive }}%</h3>
            <p>Positive Sentiment</p>
            <div class="stat-detail">{{ sentiment_counts.Positive }} reviews</div>
        </div>

        <div class="stat-card negative">
            <div class="stat-icon">
                <i class="fas fa-frown"></i>
            </div>
            <h3>{{ sentiment_percentages.Negative }}%</h3>
            <p>Negative Sentiment</p>
            <div class="stat-detail">{{ sentiment_counts.Negative }} reviews</div>
        </div>

        <div class="stat-card neutral">
            <div class="stat-icon">
                <i class="fas fa-meh"></i>
            </div>
            <h3>{{ sentiment_percentages.Neutral }}%</h3>
            <p>Neutral Sentiment</p>
            <div class="stat-detail">{{ sentiment_counts.Neutral }} reviews</div>
        </div>
    </div>

    <!-- Source Breakdown -->
    {% if source_counts and source_counts|length > 0 %}
    <div class="source-breakdown">
        <h4>
            <i class="fas fa-database"></i>
            Data Sources
        </h4>

        <div class="source-grid">
            {% for source, count in source_counts.items() %}
            <div class="source-item">
                <div class="source-name">
                    <i
                        class="fas fa-{% if 'csv' in source.lower() %}file-csv{% elif 'database' in source.lower() %}database{% elif 'upload' in source.lower() %}cloud-upload{% else %}file{% endif %}"></i>
                    <span>{{ source }}</span>
                </div>
                <div class="source-count">
                    <i class="fas fa-check-circle"></i>
                    {{ count }} review{% if count != 1 %}s{% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Category Breakdown -->
    {% if category_counts and category_counts|length > 0 %}
    <div class="category-section">
        <h4>
            <i class="fas fa-tags"></i>
            Top Complaint Categories
        </h4>

        <div class="category-tags-container">
            {% for category, count in category_counts.items()|sort(attribute='1', reverse=True) %}
            <div class="category-tag">
                <i
                    class="fas fa-{% if category == 'service' %}user-tie{% elif category == 'food_quality' %}utensils{% elif category == 'hygiene' %}soap{% elif category == 'price' %}tag{% elif category == 'delivery' %}truck{% elif category == 'portion' %}bowl{% elif category == 'ambience' %}music{% elif category == 'variety' %}book{% else %}tag{% endif %}"></i>
                <span>{{ category.replace('_', ' ').title() }}</span>
                <span class="badge">{{ count }}</span>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Visualizations Section -->
    <div class="visualization-section">
        <div class="section-header">
            <h3>
                <i class="fas fa-chart-pie"></i>
                Visual Analytics Dashboard
            </h3>
            <p>Interactive data visualizations for deeper insights</p>
        </div>

        <div class="visualizations-grid">
            <!-- Sentiment Overview -->
            {% if visualizations.sentiment_overview %}
            <div class="viz-card">
                <h4>
                    <i class="fas fa-chart-pie"></i>
                    Sentiment Overview
                </h4>
                <img src="{{ visualizations.sentiment_overview }}" alt="Sentiment Overview" loading="lazy">
            </div>
            {% endif %}

            <!-- Category Bar Chart -->
            {% if visualizations.category_bar %}
            <div class="viz-card">
                <h4>
                    <i class="fas fa-chart-bar"></i>
                    Complaint Frequency by Category
                </h4>
                <img src="{{ visualizations.category_bar }}" alt="Category Bar Chart" loading="lazy">
            </div>
            {% endif %}

            <!-- Score Distribution -->
            {% if visualizations.score_hist %}
            <div class="viz-card">
                <h4>
                    <i class="fas fa-chart-area"></i>
                    Sentiment Score Distribution
                </h4>
                <img src="{{ visualizations.score_hist }}" alt="Score Histogram" loading="lazy">
            </div>
            {% endif %}

            <!-- Rating Distribution -->
            {% if visualizations.rating_dist %}
            <div class="viz-card">
                <h4>
                    <i class="fas fa-star"></i>
                    Rating Distribution
                </h4>
                <img src="{{ visualizations.rating_dist }}" alt="Rating Distribution" loading="lazy">
            </div>
            {% endif %}

            <!-- Category vs Sentiment Heatmap -->
            {% if visualizations.category_sentiment_heatmap %}
            <div class="viz-card full-width">
                <h4>
                    <i class="fas fa-fire"></i>
                    Category vs Sentiment Analysis
                </h4>
                <img src="{{ visualizations.category_sentiment_heatmap }}" alt="Category vs Sentiment Heatmap"
                    loading="lazy">
            </div>
            {% endif %}

            <!-- Top Keywords -->
            {% if visualizations.keywords_bar %}
            <div class="viz-card full-width">
                <h4>
                    <i class="fas fa-key"></i>
                    Top Keywords in Reviews
                </h4>
                <img src="{{ visualizations.keywords_bar }}" alt="Top Keywords" loading="lazy">
            </div>
            {% endif %}

            <!-- Source Distribution -->
            {% if visualizations.source_distribution %}
            <div class="viz-card">
                <h4>
                    <i class="fas fa-database"></i>
                    Reviews by Data Source
                </h4>
                <img src="{{ visualizations.source_distribution }}" alt="Source Distribution" loading="lazy">
            </div>
            {% endif %}

            <!-- Sentiment Trend -->
            {% if visualizations.sentiment_trend %}
            <div class="viz-card full-width">
                <h4>
                    <i class="fas fa-chart-line"></i>
                    Sentiment Trend Over Time
                </h4>
                <img src="{{ visualizations.sentiment_trend }}" alt="Sentiment Trend" loading="lazy">
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Recent Reviews -->
    <div class="reviews-section">
        <div class="section-header">
            <h3>
                <i class="fas fa-comments"></i>
                Customer Reviews
            </h3>
            <p>Detailed breakdown of customer feedback and sentiments</p>
        </div>

        <div class="reviews-container">
            {% set reviewed_items = reviews[:10] %}
            {% for review in reviewed_items %}
            <div class="review-item {{ review.sentiment|lower if review.sentiment else 'neutral' }}"
                id="review-{{ loop.index }}">
                <div class="review-header">
                    <div class="review-badges">
                        <div class="badge-sentiment {{ review.sentiment|lower if review.sentiment else 'neutral' }}">
                            <i
                                class="fas fa-{{ 'smile' if review.sentiment == 'Positive' else 'frown' if review.sentiment == 'Negative' else 'meh' }}"></i>
                            {{ review.sentiment or 'Neutral' }}
                        </div>

                        {% if review.rating %}
                        <div class="badge-rating">
                            <i class="fas fa-star"></i>
                            {{ review.rating }}
                        </div>
                        {% endif %}
                    </div>

                    <div class="review-source">
                        <i class="fas fa-database"></i>
                        <span>{{ review.source_file or 'Unknown Source' }}</span>
                    </div>
                </div>

                <p class="review-text">
                    {{ review.text[:300] }}{% if review.text|length > 300 %}...{% endif %}
                </p>

                {% if review.keywords %}
                <div class="review-keywords">
                    <span class="keywords-label">
                        <i class="fas fa-tags"></i>
                        Keywords:
                    </span>
                    {% set keyword_list = review.keywords.split(',')[:6] %}
                    {% for keyword in keyword_list %}
                    <span class="keyword-badge">{{ keyword.strip() }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                {% if review.categories %}
                <div class="review-keywords">
                    <span class="keywords-label">
                        <i class="fas fa-folder"></i>
                        Categories:
                    </span>
                    {% set category_list = review.categories.split(',')[:5] %}
                    {% for category in category_list %}
                    <span class="keyword-badge" style="background: rgba(102, 126, 234, 0.1); color: #667eea;">
                        {{ category.strip().replace('_', ' ').title() }}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <!-- Load More Reviews -->
        {% if reviews|length > 10 %}
        <div class="load-more-section">
            <button class="load-more-btn" onclick="loadMoreReviews()">
                <i class="fas fa-arrow-down"></i>
                Load More Reviews ({{ reviews|length - 10 }} remaining)
            </button>
        </div>
        {% endif %}
    </div>

    <!-- Action Section -->
    <div class="action-section">
        <h4>
            <i class="fas fa-rocket"></i>
            Ready to Take Action?
        </h4>
        <p>
            Explore AI-powered recommendations and chat with our intelligent assistant
        </p>

        <div class="action-buttons">
            <a href="{{ url_for('recommendations', restaurant_name=restaurant) }}"
                class="action-btn btn-recommendations">
                <i class="fas fa-lightbulb"></i>
                <span>View AI Recommendations</span>
            </a>

            <a href="{{ url_for('chat') }}" class="action-btn btn-chat">
                <i class="fas fa-comments"></i>
                <span>Chat with AI Assistant</span>
            </a>

            <a href="{{ url_for('index') }}" class="action-btn btn-back">
                <i class="fas fa-home"></i>
                <span>Back to Dashboard</span>
            </a>
        </div>
    </div>

    <!-- Export Section -->
    <div class="export-section">
        <p>
            <i class="fas fa-download"></i>
            Need to share this report?
            <a href="#" onclick="exportReport(); return false;">
                <i class="fas fa-file-pdf"></i>
                Export as PDF
            </a>
            or
            <a href="#" onclick="window.print(); return false;">
                <i class="fas fa-print"></i>
                Print Report
            </a>
        </p>
    </div>
</div>

<script>
    // Global variables for pagination
    let reviewsData = {{ reviews| tojson }};
    let currentDisplayed = 10;

    // Load more reviews
    function loadMoreReviews() {
        const container = document.querySelector('.reviews-container');
        const nextCount = Math.min(currentDisplayed + 5, reviewsData.length);

        for (let i = currentDisplayed; i < nextCount; i++) {
            const review = reviewsData[i];
            const reviewElement = createReviewElement(review, i + 1);
            container.appendChild(reviewElement);
        }

        currentDisplayed = nextCount;

        // Hide button if all reviews loaded
        if (currentDisplayed >= reviewsData.length) {
            const btn = document.querySelector('.load-more-btn');
            if (btn) btn.style.display = 'none';
        }
    }

    // Create review element dynamically
    function createReviewElement(review, index) {
        const sentiment = review.sentiment || 'Neutral';
        const sentimentClass = sentiment.toLowerCase();

        const div = document.createElement('div');
        div.className = `review-item ${sentimentClass}`;
        div.id = `review-${index}`;
        div.style.opacity = '0';
        div.style.transform = 'translateX(-20px)';

        let html = `
      <div class="review-header">
        <div class="review-badges">
          <div class="badge-sentiment ${sentimentClass}">
            <i class="fas fa-${sentiment === 'Positive' ? 'smile' : sentiment === 'Negative' ? 'frown' : 'meh'}"></i>
            ${sentiment}
          </div>
    `;

        if (review.rating) {
            html += `
          <div class="badge-rating">
            <i class="fas fa-star"></i>
            ${review.rating}
          </div>
      `;
        }

        html += `
        </div>
        <div class="review-source">
          <i class="fas fa-database"></i>
          <span>${review.source_file || 'Unknown Source'}</span>
        </div>
      </div>

      <p class="review-text">
        ${review.text.substring(0, 300)}${review.text.length > 300 ? '...' : ''}
      </p>
    `;

        if (review.keywords) {
            const keywords = review.keywords.split(',').slice(0, 6);
            html += `
        <div class="review-keywords">
          <span class="keywords-label">
            <i class="fas fa-tags"></i>
            Keywords:
          </span>
          ${keywords.map(kw => `<span class="keyword-badge">${kw.trim()}</span>`).join('')}
        </div>
      `;
        }

        if (review.categories) {
            const categories = review.categories.split(',').slice(0, 5);
            html += `
        <div class="review-keywords">
          <span class="keywords-label">
            <i class="fas fa-folder"></i>
            Categories:
          </span>
          ${categories.map(cat => `<span class="keyword-badge" style="background: rgba(102, 126, 234, 0.1); color: #667eea;">${cat.trim().replace(/_/g, ' ').split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ')}</span>`).join('')}
        </div>
      `;
        }

        div.innerHTML = html;

        // Animate in
        setTimeout(() => {
            div.style.transition = 'all 0.5s ease';
            div.style.opacity = '1';
            div.style.transform = 'translateX(0)';
        }, 10);

        return div;
    }

    // Export report as PDF
    function exportReport() {
        const element = document.querySelector('.page-container');
        const opt = {
            margin: 10,
            filename: `recommendations-${new Date().toISOString().split('T')[0]}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' }
        };

        if (typeof html2pdf !== 'undefined') {
            html2pdf().set(opt).from(element).save();
        } else {
            window.print();
        }
    }

    // Page load animations
    document.addEventListener('DOMContentLoaded', function () {
        // Animate stat cards
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(30px)';
            setTimeout(() => {
                card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 100 + (index * 100));
        });

        // Animate review items with intersection observer
        const reviewItems = document.querySelectorAll('.review-item');
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateX(0)';
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        reviewItems.forEach(item => {
            observer.observe(item);
        });

        // Animate visualization cards
        const vizCards = document.querySelectorAll('.viz-card');
        vizCards.forEach(card => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'all 0.6s ease';
            observer.observe(card);
        });
    });

    // Smooth scrolling
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });
</script>

{% endblock %}